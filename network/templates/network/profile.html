{% extends "network/layout.html" %}

{% block title %}{{ profile_user.username }} · Profile{% endblock %}

{% block body %}
  <div class="d-flex align-items-center justify-content-between">
    <h2 class="mb-0">{{ profile_user.username }}</h2>
    {% if request.user.is_authenticated and request.user != profile_user %}
      <form action="{% url 'toggle_follow' username=profile_user.username %}" method="post" class="ml-3">
        {% csrf_token %}
        <button class="btn btn-sm btn-outline-primary">
          {% if is_following %}Unfollow{% else %}Follow{% endif %}
        </button>
      </form>
    {% endif %}
  </div>

  <p class="text-muted mb-3">
    <strong>Followers:</strong> {{ followers_count }}
    &nbsp;•&nbsp;
    <strong>Following:</strong> {{ following_count }}
  </p>

  <hr>

  {% for post in page_obj.object_list %}
    <div class="card mb-3 post"
         data-post-id="{{ post.id }}"
         data-edit-url="{% url 'edit_post' post.id %}"
         data-like-url="{% url 'toggle_like' post.id %}">
      <div class="card-body">
        <div class="d-flex justify-content-between">
          <div>
            <a href="{% url 'profile' post.author.username %}">{{ post.author.username }}</a>
            <small class="text-muted">• {{ post.timestamp }}</small>
          </div>
          <div class="d-flex align-items-center">
            {% if user.is_authenticated %}
              <button class="btn btn-sm btn-outline-danger" data-action="like">
                {% if user in post.liked_by.all %}Unlike{% else %}Like{% endif %}
              </button>
            {% endif %}
            <span class="badge bg-light text-dark ml-2" data-role="likes">❤️ {{ post.likes_count }}</span>
          </div>
        </div>
        <p class="mb-0 mt-2" data-role="content">{{ post.content }}</p>

        {% if user.is_authenticated and post.author_id == user.id %}
          <div class="mt-2">
            <button class="btn btn-sm btn-outline-secondary" data-action="edit">Edit</button>
          </div>
        {% endif %}
      </div>
    </div>
  {% empty %}
    <p class="text-muted">No posts yet.</p>
  {% endfor %}

  <nav aria-label="profile posts pages" class="mt-3">
    <ul class="pagination mb-0">
      {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Previous</span></li>
      {% endif %}

      <li class="page-item disabled">
        <span class="page-link">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
      </li>

      {% if page_obj.has_next %}
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">Next</span></li>
      {% endif %}
    </ul>
  </nav>
{% endblock %}
